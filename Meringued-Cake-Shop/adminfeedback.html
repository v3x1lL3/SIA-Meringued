<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Feedback - Admin - Meringued</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap');
        :root {
            --gold: #D4AF37;
            --gold-dark: #B8941E;
            --cream: #FFF8F0;
        }
        body { font-family: 'Inter', sans-serif; }
        .font-display { font-family: 'Playfair Display', serif; }
        .sidebar-active { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); color: white !important; }
        .sidebar-active:hover { background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold) 100%); color: white !important; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="fixed left-0 top-0 h-screen w-64 bg-white/95 backdrop-blur-md shadow-xl border-r-2 border-[#D4AF37]/20 z-50 flex flex-col">
        <div class="p-6 border-b-2 border-[#D4AF37]/20">
            <a href="admindashboard.html" class="font-display text-3xl font-bold text-[#D4AF37] hover:opacity-80 transition">Meringued</a>
            <p class="text-xs text-gray-500 mt-1">Admin Panel</p>
        </div>
        <nav class="flex-1 p-6">
            <ul class="space-y-2">
                <li>
                    <a href="adminordering.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium">
                        <i class="fas fa-shopping-bag w-5"></i><span>Orders</span>
                    </a>
                </li>
                <li>
                    <a href="admininventory.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium">
                        <i class="fas fa-boxes-stacked w-5"></i><span>Inventory</span>
                    </a>
                </li>
                <li>
                    <a href="adminhistory.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium">
                        <i class="fas fa-history w-5"></i><span>Logs</span>
                    </a>
                </li>
                <li>
                    <a href="admincustomers.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium">
                        <i class="fas fa-users w-5"></i><span>Customers</span>
                    </a>
                </li>
                <li>
                    <a href="adminfeedback.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium sidebar-active">
                        <i class="fas fa-comment-alt w-5"></i><span>Feedback</span>
                    </a>
                </li>
                <li>
                    <a href="adminsettings.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-[#FFF8F0] hover:text-[#D4AF37] transition font-medium">
                        <i class="fas fa-cog w-5"></i><span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="p-6 border-t-2 border-[#D4AF37]/20">
            <button onclick="openLogoutModal()" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition font-medium w-full">
                <i class="fas fa-sign-out-alt w-5"></i><span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen bg-[#FFF8F0]/30">
        <div class="px-6 py-8 md:py-12">
            <div class="mb-8">
                <h1 class="font-display text-4xl md:text-5xl font-bold mb-2 text-[#D4AF37]">
                    <i class="fas fa-comment-alt mr-3"></i>Customer Feedback
                </h1>
                <p class="text-gray-600">Feedback submitted by clients from the &quot;Share Feedback&quot; option on the client dashboard.</p>
            </div>

            <div class="bg-white/90 rounded-2xl shadow-lg border-2 border-[#D4AF37]/20 p-5 md:p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-display text-xl font-bold text-gray-800">
                        <i class="fas fa-list mr-2 text-[#D4AF37]"></i>All feedback
                    </h2>
                    <p id="feedbackCount" class="text-sm text-gray-500"></p>
                </div>

                <div id="feedbackList" class="space-y-4">
                    <!-- Feedback cards rendered here -->
                </div>

                <div id="feedbackEmpty" class="text-center py-12 text-gray-400 hidden">
                    <i class="fas fa-comments text-6xl mb-4 opacity-30"></i>
                    <h3 class="text-xl font-semibold mb-2">No feedback yet</h3>
                    <p>Customer feedback from the client &quot;Share Feedback&quot; button will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logoutModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center transform transition-all">
            <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, #D4AF37 0%, #B8941E 100%);">
                <i class="fas fa-sign-out-alt text-white text-3xl"></i>
            </div>
            <h3 class="font-display text-2xl font-bold mb-2" style="color: #D4AF37;">Logout?</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to logout?</p>
            <div class="flex space-x-4 justify-center">
                <button onclick="closeLogoutModal()" class="px-6 py-3 rounded-lg text-gray-700 font-semibold bg-gray-200 hover:bg-gray-300 transition">Cancel</button>
                <button onclick="confirmLogout()" class="px-6 py-3 rounded-lg text-white font-semibold" style="background: linear-gradient(135deg, #D4AF37 0%, #B8941E 100%);">Logout</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'customerFeedbacks';

        function escapeHtml(str) {
            if (str == null) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function formatDate(isoString) {
            if (!isoString) return 'â€”';
            try {
                const d = new Date(isoString);
                return d.toLocaleDateString(undefined, { dateStyle: 'medium' }) + ' ' + d.toLocaleTimeString(undefined, { timeStyle: 'short' });
            } catch (e) { return isoString; }
        }

        function starsHtml(rating) {
            const r = Math.min(5, Math.max(0, Number(rating) || 0));
            let html = '';
            for (let i = 1; i <= 5; i++) {
                html += i <= r
                    ? '<i class="fas fa-star text-[#D4AF37]"></i>'
                    : '<i class="far fa-star text-gray-300"></i>';
            }
            return html;
        }

        function renderFeedbacks() {
            const listEl = document.getElementById('feedbackList');
            const emptyEl = document.getElementById('feedbackEmpty');
            const countEl = document.getElementById('feedbackCount');

            let feedbacks = [];
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) feedbacks = JSON.parse(raw);
            } catch (e) { feedbacks = []; }

            // Newest first
            feedbacks = feedbacks.slice().sort(function (a, b) {
                const ta = (a.date && new Date(a.date).getTime()) || 0;
                const tb = (b.date && new Date(b.date).getTime()) || 0;
                return tb - ta;
            });

            countEl.textContent = feedbacks.length === 0 ? '' : feedbacks.length + ' feedback' + (feedbacks.length !== 1 ? 's' : '');

            if (feedbacks.length === 0) {
                listEl.innerHTML = '';
                listEl.classList.add('hidden');
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');
            listEl.classList.remove('hidden');
            listEl.innerHTML = feedbacks.map(function (f) {
                return (
                    '<div class="bg-[#FFF8F0] rounded-xl p-4 md:p-5 border-2 border-[#D4AF37]/20">' +
                    '  <div class="flex flex-wrap items-center justify-between gap-2 mb-2">' +
                    '    <span class="font-semibold text-gray-800">' + escapeHtml(f.customer || 'Guest') + '</span>' +
                    '    <span class="text-sm text-gray-500">' + escapeHtml(formatDate(f.date)) + '</span>' +
                    '  </div>' +
                    '  <div class="flex items-center gap-1 mb-3 text-lg">' + starsHtml(f.rating) + '</div>' +
                    '  <p class="text-gray-700 whitespace-pre-wrap">' + escapeHtml(f.text || '') + '</p>' +
                    '</div>'
                );
            }).join('');
        }

        function openLogoutModal() {
            document.getElementById('logoutModal').classList.remove('hidden');
            document.getElementById('logoutModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }
        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.add('hidden');
            document.getElementById('logoutModal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }
        function confirmLogout() {
            window.location.href = 'index.html';
        }
        document.getElementById('logoutModal').addEventListener('click', function (e) {
            if (e.target === e.currentTarget) closeLogoutModal();
        });
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeLogoutModal();
        });

        document.addEventListener('DOMContentLoaded', renderFeedbacks);
    </script>
</body>
</html>
